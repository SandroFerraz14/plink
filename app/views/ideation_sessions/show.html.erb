<% if current_user.id==@ideation_session.user_id or 
	@participants.where(email: current_user.email, ideation_session_id: @ideation_session.id).exists? %>

    <!-- faz utilizador ficar activo se ainda não o era na sessão e adicionar o user_id ao participante = ao current_user.id -->
    <% if @participants.where(email: current_user.email, ideation_session_id: @ideation_session.id).take.active == false %>
        <% @part = @participants.where(email: current_user.email, ideation_session_id: @ideation_session.id).take.update_attribute(:active, true) %>
    	o utilizador foi activado
    <% else %>
    	utilizador já activo
	<% end %>

    <!-- define o nickname e imagem do participante, consoante o anonimato da sessão -->
	<!-- todos anonimos, por defeito, não precisa fazer nada -->
	- Anonimato: <%= @ideation_session.anonymity %> - 

	<!-- sem anonimato -->
	<% if @ideation_session.anonymity==0 %>

		<% if current_user.user_photo_file_name %>
			<% @part = @participants.where(email: current_user.email, ideation_session_id: @ideation_session.id).take.update_attributes(avatar_file_name: current_user.user_photo_file_name, nickname: current_user.email) %>
	        -- a usar email e foto de utilizador para o participante --
	    <% else %>
	    	<% @part = @participants.where(email: current_user.email, ideation_session_id: @ideation_session.id).take.update_attributes(nickname: current_user.email) %>
	        -- a usar email de utilizador e foto por defeito para o participante --
	    <% end %>

	<!-- o user decide -->
	<% elsif @ideation_session.anonymity==2 %>
		<!-- aparece se user está como anonimo ou não, comparando se o nickname = email -->
		<!-- se anon -> um botão, se não outro -->
		<% @part = @participants.where(email: current_user.email, ideation_session_id: @ideation_session.id).take %>
		<% if @part.nickname == current_user.email %>
			O utilizador está identificado

			<%= button_to "Set Anonymous", { :controller => "ideation_sessions", :action => "set_anonymous"} %>
		<% else %>
			O utilizador está anonimo.
			<%= button_to "Set Identified", { :controller => "ideation_sessions", :action => "set_identified"} %>
		<% end %>
	<% end %>
	
	<p id="notice"><%= notice %></p>

	<p>
	  <strong>Name:</strong>
	  <%= @ideation_session.name %>
	</p>

	<p>
	  <strong>Description:</strong>
	  <%= @ideation_session.description %>
	</p>
	<%= render 'themes/partial_index' %>
	<%= render 'themes/form' %>
	<%= render 'ideas/partial_index' %>
	<%= render 'ideas/form' %>

	<% if current_user.id==@ideation_session.user_id %>
		<%= render 'participants/partial_index' %>
		<%= render 'participants/form' %>
	<% end %>
	<%= link_to 'Edit', edit_ideation_session_path(@ideation_session) %> |
	<%= link_to 'Back', ideation_sessions_path %>
	<% #link_to 'Participantes', ideation_session_participants_path(@ideation_session) %>

<% else %>
	<p>
		Não tem acesso a esta sessão
	</p>
<% end %>	